# Rule 55 - 신중하게 최적화 하라

최적화를 할 때는 아래의 두 규칙을 따르라

- 하지 마라
- (전문가들만 따를 것) 아직은 하지 마라. 완벽히 명료한, 최적화되지 않은 해답을 얻을 때 까지는

## 빠른 프로그램이 아닌 좋은 프로그램을 만들려 노력하라

좋은 구조를 갖추면, 최적화의 여지도 충분할 것이다. 

## 설계를 할 때는 성능을 제약할 가능성이 있는 결정들은 피하라

설계 가운데 성능에 문제가 있다는 사실이 발견된 후에 고치기가 가장 까다로운 부분은 모듈간 상호작용이나 외부와의 상호작용을 명시하는 부분이다. 그 중에 가장 중요한 것으로는 
API, 통신 프로토콜, persistent data format 등이 있다. 이런 부분들은 성능 문제가 발견된 후에는 수정하기 어렵거나 불가능하며, 시스템이 낼 수 있는 성능의 최대치에 큰 영향을 준다.

## API 를 설계할 때 내리는 결정들이 성능에 어떤 영향을 끼칠지를 생각하라

- public 자료형을 변경 가능하게 만들면 쓸데 없이 방어적 복사를 많이 해야 할 수 있다.
- **composition** 이 적절할 클래스에 **inheritance** 를 사용하면 하위 클래스의 성능에 인위적인 제약이 가해질 수도 있다.
- 또한 인터페이스가 적당할 API 에 구현 자료형을 사용해 버리면 나중에 더 빠른 구현이 나와도 개선하기 어려워 진다.

잘 설계된 API 는 일반적으로 좋은 성능을 보인다. 좋은 성능을 내기 위해 API 를 급진적으로 바꾸는 것은 바람직하지 않다.

## 최적화를 시도할 때마다 전후 성능을 측정하고 비교하라

성능측정은 상당히 중요한데, 자바의 성능 모델은 제대로 정의되어 있지 않을 뿐 만 아니라 JVM 구현마다, 릴리즈마다, 프로세서마다 다르다.

## 요약

빠른 프로그램 대신 좋은 프로그램을 만들고자 애써라. 성능은 따라올 것이다. 하지만 시스템을 설계할 때 API, 통신 프로토콜, persistent 를 설계할때는 성능 문제를 따져야 한다. 
구현이 끝났다면 성능을 측정해보고, 프로파일링 도구의 도움을 받아 최적화 하면 된다. 최적화시 먼저 해야할 일은 알고리즘을 검토하는 것이다. 